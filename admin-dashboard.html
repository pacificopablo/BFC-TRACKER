<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Baccarat Fund Club - Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 text-white min-h-screen p-4">

  <!-- Header -->
  <header class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">ğŸ² Baccarat Fund Club - Admin</h1>
    <button class="bg-red-600 text-white px-4 py-2 rounded">Logout</button>
  </header>

  <!-- Tab Buttons -->
  <div id="tabButtons" class="flex space-x-4 text-sm font-semibold mb-6">
    <button onclick="showTab('members', this)" class="tab-btn px-3 py-1 rounded">ğŸ‘¤ Members</button>
    <button onclick="showTab('requests', this)" class="tab-btn px-3 py-1 rounded">ğŸ’¸ Cash Outs</button>
    <button onclick="showTab('profits', this)" class="tab-btn px-3 py-1 rounded">ğŸ“ˆ Profits</button>
    <button onclick="showTab('settings', this)" class="tab-btn px-3 py-1 rounded">âš™ï¸ Settings</button>
  </div>

  <!-- ğŸ‘¤ Members Tab -->
  <section id="members" class="tab-content hidden">
    <h2 class="text-lg font-semibold mb-2">ğŸ‘¥ Member List</h2>
    <div id="memberList" class="space-y-2"></div>
  </section>

  <!-- ğŸ’¸ Requests Tab -->
  <section id="requests" class="tab-content hidden"><p>Cash out requests section goes here...</p></section>

  <!-- ğŸ“ˆ Profits Tab -->
  <section id="profits" class="tab-content hidden"><p>Profit distribution section goes here...</p></section>

  <!-- âš™ï¸ Settings Tab -->
  <section id="settings" class="tab-content hidden">
    <h2 class="text-lg font-semibold mb-2">âš™ï¸ Settings</h2>
    <div class="space-y-4">
      <div>
        <label class="block mb-1 font-medium">ğŸ”„ Conversion Rate (â‚± per share):</label>
        <input type="number" id="conversionRateInput" class="border p-2 w-full text-black" min="1" step="1" />
        <button onclick="updateConversionRate()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded">ğŸ’¾ Save Rate</button>
      </div>
      <div>
        <button onclick="exportToCSV()" class="bg-green-600 text-white px-4 py-2 rounded">ğŸ“¥ Export CSV</button>
        <button onclick="cleanupOldPending()" class="bg-yellow-500 text-white px-4 py-2 rounded ml-2">ğŸ§¹ Clean Old Pending</button>
      </div>
    </div>
  </section>

  <!-- Firebase and Member Logic -->
  <script type="module">
    import { db } from './firebase-config.js';
    import {
      doc, getDoc, updateDoc, collection, getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    let conversionRate = 10;

    async function loadConversionRate() {
      const docRef = doc(db, "settings", "conversion");
      const snap = await getDoc(docRef);
      if (snap.exists()) {
        conversionRate = snap.data().rate || 10;
        document.getElementById("conversionRateInput").value = conversionRate;
      }
    }

    window.updateConversionRate = async () => {
      const newRate = parseFloat(document.getElementById("conversionRateInput").value);
      if (isNaN(newRate) || newRate <= 0) return alert("Please enter a valid rate.");
      await updateDoc(doc(db, "settings", "conversion"), { rate: newRate });
      conversionRate = newRate;
      alert(`âœ… Conversion rate updated to â‚±${newRate} per share.`);
      loadMembers(); // Refresh balances
    };

    async function loadMembers() {
      const memberList = document.getElementById("memberList");
      memberList.innerHTML = '<p>Loading...</p>';

      const querySnapshot = await getDocs(collection(db, "members"));
      memberList.innerHTML = ""; // Clear loading

      if (querySnapshot.empty) {
        memberList.innerHTML = "<p>No members found.</p>";
        return;
      }

      querySnapshot.forEach(doc => {
        const data = doc.data();
        const shares = data.shares || 0;
        const balance = shares * conversionRate;

        const div = document.createElement("div");
        div.className = "bg-gray-800 p-4 rounded shadow";
        div.innerHTML = `
          <div class="font-semibold text-lg">${data.name || 'Unnamed Member'}</div>
          <div>Email: ${data.email || '-'}</div>
          <div>Shares: ${shares}</div>
          <div>Balance: â‚±${balance.toLocaleString(undefined, { minimumFractionDigits: 2 })}</div>
        `;
        memberList.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", async () => {
      await loadConversionRate();
      await loadMembers();
    });
  </script>

  <!-- Tab Navigation -->
  <script>
    function showTab(tabId, button = null) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
      document.getElementById(tabId)?.classList.remove('hidden');
      document.querySelectorAll('#tabButtons .tab-btn').forEach(btn => {
        btn.classList.remove('bg-white', 'text-black');
        btn.classList.add('hover:underline');
      });
      if (button) {
        button.classList.remove('hover:underline');
        button.classList.add('bg-white', 'text-black');
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const defaultBtn = document.querySelector('#tabButtons .tab-btn');
      if (defaultBtn) showTab('members', defaultBtn);
    });

    function exportToCSV() {
      alert("CSV export not implemented yet.");
    }

    function cleanupOldPending() {
      alert("Cleanup not implemented yet.");
    }
  </script>
</body>
</html>
