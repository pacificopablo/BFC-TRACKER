<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baccarat Fund Club Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>

<body class="bg-gray-900 text-white min-h-screen p-4">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">üé∞ Baccarat Fund Club Dashboard</h1>
    <div id="userInfo" class="mb-6 text-center text-green-300"></div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden bg-gray-800 p-4 rounded-xl mb-8">
      <h2 class="text-xl font-semibold mb-4">üëë Admin Panel</h2>
      <div class="grid grid-cols-2 gap-4 mb-4">
        <input id="newEmail" class="p-2 rounded bg-gray-700" placeholder="New Member Email">
        <input id="newPassword" type="password" class="p-2 rounded bg-gray-700" placeholder="Password">
        <input id="newName" class="p-2 rounded bg-gray-700" placeholder="Full Name">
        <input id="newPhone" class="p-2 rounded bg-gray-700" placeholder="Phone Number">
        <input id="newShares" class="p-2 rounded bg-gray-700" type="number" placeholder="Shares (‚Ç±10/share)">
      </div>
      <button onclick="registerMember()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">Register Member</button>
      <p id="adminMsg" class="mt-4 text-green-400"></p>
    </div>

    <!-- Member Dashboard -->
    <div id="memberPanel" class="hidden bg-gray-800 p-4 rounded-xl mb-8">
      <h2 class="text-xl font-semibold mb-4">üë§ My Account</h2>
      <div id="memberInfo" class="mb-4"></div>

      <h3 class="text-lg font-bold mb-2">üí∞ Submit Deposit/Withdraw Request</h3>
      <select id="requestType" class="p-2 rounded bg-gray-700 mb-2 w-full">
        <option value="deposit">Deposit</option>
        <option value="withdraw">Withdraw</option>
      </select>
      <input id="requestAmount" type="number" class="p-2 rounded bg-gray-700 mb-2 w-full" placeholder="Amount in ‚Ç±">
      <textarea id="requestNote" class="p-2 rounded bg-gray-700 mb-4 w-full" placeholder="Optional notes..."></textarea>
      <button onclick="submitRequest()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">Submit Request</button>
      <p id="requestMsg" class="mt-2 text-green-400"></p>
    </div>

    <div class="text-center">
      <button onclick="logout()" class="mt-6 bg-red-600 hover:bg-red-700 px-4 py-2 rounded">Logout</button>
    </div>
  </div>

  <script type="module">
    import { auth, db } from './firebase-config.js';
    import {
      signOut,
      onAuthStateChanged,
      createUserWithEmailAndPassword
    } from 'https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js';
    import {
      doc,
      setDoc,
      getDoc,
      collection,
      addDoc,
    } from 'https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js';

    const adminEmail = "smoakshadow@gmail.com";

    const adminPanel = document.getElementById('adminPanel');
    const memberPanel = document.getElementById('memberPanel');
    const userInfo = document.getElementById('userInfo');

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      userInfo.textContent = `Logged in as: ${user.email}`;

      if (user.email === adminEmail) {
        adminPanel.classList.remove('hidden');
      } else {
        memberPanel.classList.remove('hidden');

        const memberDoc = await getDoc(doc(db, 'members', user.uid));
        if (memberDoc.exists()) {
          const data = memberDoc.data();
          document.getElementById('memberInfo').innerHTML = `
            <p><strong>Name:</strong> ${data.name}</p>
            <p><strong>Phone:</strong> ${data.phone}</p>
            <p><strong>Shares:</strong> ${data.shares}</p>
            <p><strong>Value:</strong> ‚Ç±${data.shares * 10}</p>
            <p><strong>Joined:</strong> ${data.joinDate}</p>
          `;
        } else {
          document.getElementById('memberInfo').innerHTML = `<p class="text-red-400">‚ö†Ô∏è Profile not set by admin yet.</p>`;
        }
      }
    });

    // Logout
    function logout() {
      signOut(auth).then(() => {
        window.location.href = 'index.html';
      });
    }

    // Admin: Register Member
    async function registerMember() {
      const email = document.getElementById('newEmail').value.trim();
      const password = document.getElementById('newPassword').value.trim();
      const name = document.getElementById('newName').value.trim();
      const phone = document.getElementById('newPhone').value.trim();
      const shares = parseInt(document.getElementById('newShares').value);
      const joinDate = new Date().toISOString().split('T')[0];

      if (!email || !password || !name || !shares) return alert("Fill in all fields");

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const uid = userCredential.user.uid;

        await setDoc(doc(db, "members", uid), {
          name,
          phone,
          shares,
          joinDate,
          deposits: 0,
          withdrawals: 0,
          balance: shares * 10
        });

        document.getElementById('adminMsg').textContent = `‚úÖ Member ${email} registered successfully.`;
      } catch (err) {
        document.getElementById('adminMsg').textContent = `‚ùå ${err.message}`;
      }
    }

    // Member: Submit Deposit/Withdraw Request
    async function submitRequest() {
      const user = auth.currentUser;
      const type = document.getElementById('requestType').value;
      const amount = parseInt(document.getElementById('requestAmount').value);
      const note = document.getElementById('requestNote').value;

      if (!amount || amount <= 0) return alert("Enter valid amount");

      await addDoc(collection(db, "requests"), {
        uid: user.uid,
        email: user.email,
        type,
        amount,
        note,
        status: "pending",
        date: new Date().toISOString()
      });

      document.getElementById('requestMsg').textContent = `‚úÖ ${type} request submitted.`;
      document.getElementById('requestAmount').value = '';
      document.getElementById('requestNote').value = '';
    }
  </script>
</body>

</html>
