<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baccarat Fund Login</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
      <!-- Header -->
      <h1 class="text-2xl font-bold mb-6 flex items-center justify-center">
        <span class="mr-2">ðŸ‘‘</span> Baccarat Fund Login
      </h1>

      <!-- Login Form -->
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-1" for="email">Email</label>
          <input
            type="email"
            id="email"
            class="w-full p-2 bg-gray-700 rounded text-white"
            placeholder="Enter your email"
            required
          />
        </div>
        <div>
          <label class="block text-sm mb-1" for="password">Password</label>
          <input
            type="password"
            id="password"
            class="w-full p-2 bg-gray-700 rounded text-white"
            placeholder="Enter your password"
            required
          />
        </div>
        <button
          type="submit"
          id="loginBtn"
          class="w-full bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-600"
        >
          Login
        </button>
        <p id="loginError" class="text-red-500 text-sm mt-2 hidden"></p>
      </form>

      <!-- Forgot Password Section -->
      <div id="forgotPasswordSection" class="mt-4">
        <p class="text-sm text-gray-400 mb-2">Forgot your password?</p>
        <input
          type="email"
          id="resetEmail"
          placeholder="Enter your email"
          class="w-full p-2 bg-gray-700 rounded text-white mb-2"
        />
        <button
          id="resetPasswordBtn"
          class="w-full bg-yellow-600 px-4 py-2 rounded hover:bg-yellow-700 disabled:bg-gray-600"
        >
          Send Reset Link
        </button>
        <p id="resetMessage" class="text-sm mt-2 hidden"></p>
      </div>
    </div>

    <script type="module">
      // Firebase Imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyCN0dBQXoaWh_13lF0ON25otUpeH3OGINQ",
        authDomain: "bfc-tracker.firebaseapp.com",
        projectId: "bfc-tracker",
        storageBucket: "bfc-tracker.firebasestorage.app",
        messagingSenderId: "127052459580",
        appId: "1:127052459580:web:c3d5caa9302238c11cdd39",
        measurementId: "G-PNYRCFJHYM",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // DOM Elements
      const elements = {
        loginForm: document.getElementById("loginForm"),
        email: document.getElementById("email"),
        password: document.getElementById("password"),
        loginBtn: document.getElementById("loginBtn"),
        loginError: document.getElementById("loginError"),
        resetEmail: document.getElementById("resetEmail"),
        resetPasswordBtn: document.getElementById("resetPasswordBtn"),
        resetMessage: document.getElementById("resetMessage"),
      };

      // Utility Function to Show Messages
      const showMessage = (element, message, isError = true) => {
        element.textContent = message;
        element.classList.remove("hidden", isError ? "text-green-500" : "text-red-500");
        element.classList.add(isError ? "text-red-500" : "text-green-500");
        setTimeout(() => element.classList.add("hidden"), 5000);
      };

      // Login Form Submission
      elements.loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        elements.loginBtn.disabled = true;

        try {
          const userCredential = await signInWithEmailAndPassword(auth, elements.email.value, elements.password.value);
          const user = userCredential.user;

          // Check user role in Firestore
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const userData = userDoc.data();
            if (userData.role === "admin") {
              window.location.href = "admin-dashboard.html"; // Redirect to admin dashboard
            } else {
              window.location.href = "member-dashboard.html"; // Redirect to member dashboard
            }
          } else {
            throw new Error("User profile not found. Please contact support.");
          }
        } catch (error) {
          showMessage(elements.loginError, `Error: ${error.message}`);
        } finally {
          elements.loginBtn.disabled = false;
        }
      });

      // Forgot Password
      elements.resetPasswordBtn.addEventListener("click", async () => {
        const email = elements.resetEmail.value;
        if (!email) {
          showMessage(elements.resetMessage, "Please enter your email address.");
          return;
        }

        elements.resetPasswordBtn.disabled = true;
        try {
          await sendPasswordResetEmail(auth, email);
          showMessage(elements.resetMessage, "Password reset email sent! Check your inbox.", false);
          elements.resetEmail.value = "";
        } catch (error) {
          showMessage(elements.resetMessage, `Error: ${error.message}`);
        } finally {
          elements.resetPasswordBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
