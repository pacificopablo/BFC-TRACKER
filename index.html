<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Baccarat Fund Signup</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md">
      <!-- Header -->
      <h1 class="text-2xl font-bold mb-6 flex items-center justify-center">
        <span class="mr-2">ðŸ’¸</span> Baccarat Fund Signup
      </h1>

      <!-- Signup Form -->
      <form id="signupForm" class="space-y-4">
        <div>
          <label class="block text-sm mb-1" for="name">Name</label>
          <input
            type="text"
            id="name"
            class="w-full p-2 bg-gray-700 rounded text-white"
            placeholder="Enter your name"
            required
          />
        </div>
        <div>
          <label class="block text-sm mb-1" for="email">Email</label>
          <input
            type="email"
            id="email"
            class="w-full p-2 bg-gray-700 rounded text-white"
            placeholder="Enter your email"
            required
          />
        </div>
        <div>
          <label class="block text-sm mb-1" for="password">Password</label>
          <input
            type="password"
            id="password"
            class="w-full p-2 bg-gray-700 rounded text-white"
            placeholder="Enter your password"
            required
          />
        </div>
        <button
          type="submit"
          id="signupBtn"
          class="w-full bg-blue-600 px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-600"
        >
          Sign Up
        </button>
        <p id="signupError" class="text-red-500 text-sm mt-2 hidden"></p>
      </form>

      <!-- Login Link -->
      <div class="mt-4 text-center">
        <p class="text-sm text-gray-400">
          Already have an account? <a href="login.html" class="text-blue-400 hover:underline">Login</a>
        </p>
      </div>
    </div>

    <script type="module">
      // Firebase Imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

      // Firebase Config
      const firebaseConfig = {
        apiKey: "AIzaSyCN0dBQXoaWh_13lF0ON25otUpeH3OGINQ",
        authDomain: "bfc-tracker.firebaseapp.com",
        projectId: "bfc-tracker",
        storageBucket: "bfc-tracker.firebasestorage.app",
        messagingSenderId: "127052459580",
        appId: "1:127052459580:web:c3d5caa9302238c11cdd39",
        measurementId: "G-PNYRCFJHYM",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // DOM Elements
      const elements = {
        signupForm: document.getElementById("signupForm"),
        name: document.getElementById("name"),
        email: document.getElementById("email"),
        password: document.getElementById("password"),
        signupBtn: document.getElementById("signupBtn"),
        signupError: document.getElementById("signupError"),
      };

      // Utility Function to Show Messages
      const showMessage = (element, message, isError = true) => {
        element.textContent = message;
        element.classList.remove("hidden", isError ? "text-green-500" : "text-red-500");
        element.classList.add(isError ? "text-red-500" : "text-green-500");
        setTimeout(() => element.classList.add("hidden"), 5000);
      };

      // Signup Form Submission
      elements.signupForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        elements.signupBtn.disabled = true;

        try {
          const userCredential = await createUserWithEmailAndPassword(
            auth,
            elements.email.value,
            elements.password.value
          );
          const user = userCredential.user;

          // Create user document in Firestore
          await setDoc(doc(db, "users", user.uid), {
            role: "member", // Default to member; admins should be set manually or via admin panel
            email: elements.email.value,
            name: elements.name.value,
            status: "pending", // Matches your dashboard logic
            shares: 0,
            balance: 0,
            approvalDate: null,
          });

          showMessage(elements.signupError, "Account created successfully! Redirecting to login...", false);
          setTimeout(() => (window.location.href = "login.html"), 2000);
        } catch (error) {
          showMessage(elements.signupError, `Error: ${error.message}`);
        } finally {
          elements.signupBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
