<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Baccarat Fund Club</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-900 text-white p-6">
  <div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-3xl font-bold">üõ†Ô∏è Admin Dashboard</h1>
      <button onclick="logout()" class="bg-red-600 px-3 py-1 rounded">Logout</button>
    </div>

    <div class="mb-6">
      <h2 class="text-xl font-semibold mb-2">üì• Pending Members</h2>
      <ul id="pendingList" class="space-y-2"></ul>
    </div>

    <div>
      <h2 class="text-xl font-semibold mb-2">‚úÖ Approved Members</h2>
      <ul id="approvedList" class="space-y-2"></ul>
    </div>
  </div>

  <script>
    if (!(localStorage.getItem("admin") || sessionStorage.getItem("admin"))) {
      window.location.href = "index.html";
    }

    async function loadMembers() {
      let data;
      try {
        const res = await fetch('users.json');
        data = await res.json();
      } catch {
        data = { members: [], admin: null };
      }

      const pending = JSON.parse(localStorage.getItem("pendingMembers") || "[]");
      const approvedLocal = JSON.parse(localStorage.getItem("approvedMembers") || "[]");

      // Combine JSON approved and local approved
      const approved = data.members.concat(approvedLocal);

      // Display pending
      const pendingList = document.getElementById("pendingList");
      if (pending.length === 0) pendingList.innerHTML = "<li>No pending members</li>";
      else
        pendingList.innerHTML = pending
          .map(
            (m, i) => `
          <li class="bg-gray-800 p-3 rounded">
            <p><strong>${m.name}</strong> (${m.email})</p>
            <p>Shares: ${m.shares} | Balance: ‚Ç±${m.balance}</p>
            <button onclick="approve(${i})" class="bg-green-600 mt-2 px-2 py-1 rounded">Approve</button>
            <button onclick="reject(${i})" class="bg-red-600 mt-2 px-2 py-1 rounded ml-2">Reject</button>
          </li>
        `
          )
          .join("");

      // Display approved
      const approvedList = document.getElementById("approvedList");
      if (approved.length === 0) approvedList.innerHTML = "<li>No approved members</li>";
      else
        approvedList.innerHTML = approved
          .map(
            (m, i) => `
          <li class="bg-gray-800 p-3 rounded">
            <p><strong>${m.name}</strong> (${m.email})</p>
            <p>Shares: ${m.shares} | Balance: ‚Ç±${m.balance}</p>
            <button onclick="deleteMember(${i})" class="bg-red-600 mt-2 px-2 py-1 rounded">Delete</button>
          </li>
        `
          )
          .join("");
    }

    function approve(index) {
      let pending = JSON.parse(localStorage.getItem("pendingMembers") || "[]");
      let approvedLocal = JSON.parse(localStorage.getItem("approvedMembers") || "[]");
      const member = pending.splice(index, 1)[0];
      approvedLocal.push(member);
      localStorage.setItem("pendingMembers", JSON.stringify(pending));
      localStorage.setItem("approvedMembers", JSON.stringify(approvedLocal));
      loadMembers();
    }

    function reject(index) {
      let pending = JSON.parse(localStorage.getItem("pendingMembers") || "[]");
      pending.splice(index, 1);
      localStorage.setItem("pendingMembers", JSON.stringify(pending));
      loadMembers();
    }

    function deleteMember(index) {
      // We cannot delete JSON-based members; only localStorage approved
      let approvedLocal = JSON.parse(localStorage.getItem("approvedMembers") || "[]");
      approvedLocal.splice(index - JSON.parse(localStorage.getItem("approvedMembers") || "[]").length, 1);
      localStorage.setItem("approvedMembers", JSON.stringify(approvedLocal));
      loadMembers();
    }

    function logout() {
      localStorage.removeItem("admin");
      sessionStorage.removeItem("admin");
      window.location.href = "index.html";
    }

    loadMembers();
  </script>
</body>
</html>
